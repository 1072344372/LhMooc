<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>课程</title>
    <link rel="stylesheet" href="../../css/course.css">
</head>

<body>
    <!-- 头部开始 -->
    <iframe src="../../component/heard.html?nav=index" width=100% height=120px marginwidth=0 marginheight=0
        frameborder="0" scrolling="no" style="position: fixed;z-index: 1001;background-color: LightBlue;">
        <a>你的浏览器不支持iframe页面嵌套，请点击这里访问页面内容。</a>
    </iframe>
    <!-- 头部结束 -->
    <div class="contatiner" style="padding-top: 130px;">
        <div class="main">
            <!--筛选栏-->
            <div id="filter">

                <!--按类别筛选-->
                <div id="filter-class">

                </div>

                <!--按排序筛选-->
                <div id="filter-sort">
                    <span>
                        <h4>排序方式</h4>
                    </span>
                    <input type="button" value="默认">
                    <input type="button" value="收藏数" onclick="searchBySortType(1)">
                    <input type="button" value="点赞数" onclick="searchBySortType(2)">
                    <input type="button" value="评论数" onclick="searchBySortType(3)">
                    <input type="button" value="时间" onclick="searchBySortType(4)">
                </div>
            </div>

            <!--课程列表栏-->
            <div id="course-list" style="padding-bottom: 100px;">
                <!--课程-->
            </div>
        </div>

        <!-- 尾部开始 -->
        <iframe src="../../component/foot.html" width=100% height=300px marginwidth=0 marginheight=0 frameborder="0"
            scrolling="no" style="margin-top: 50px;">
            <a>你的浏览器不支持iframe页面嵌套，请点击这里访问页面内容。</a>
        </iframe>
        <!-- 尾部结束 -->

    </div>
    <script src="../../js/jquery-3.6.0.js"></script>
    <script>
        var categoryList = {};
        var pageNo = 1; //默认第一页
        var pageSize = 5; //默认分页2
        var sortType = 0; //默认排序查询
        window.onload = function () {
            loadCategories(); // 在页面加载时加载全部课程分类
            searchCourseByCategory(1); // 在页面加载时查询全部课程
        };

        // 加载全部课程分类
        function loadCategories() {
            $.ajax({
                url: 'LhMooc/categoryServlet',
                type: 'get',
                data: {
                    action: "getAll"
                },
                dataType: "JSON",
                success: function (res) {
                    if (res.code === 200) {
                        categoryList = res.data;
                        console.log("categoryList", categoryList);
                        fillCategorySelects();
                    } else {
                        alert(res.msg);
                    }
                },
                error: function (err) {
                    console.log('error', err);
                },
            });
        }

        // 填充课程分类
        function fillCategorySelects() {
            var filterClass = $("#filter-class");
            filterClass.empty(); // 清除原来的内容

            // 添加新的类别按钮
            filterClass.append('<span><h4>类别</h4></span>');
            $.each(categoryList, function (index, category) {
                var button = $('<input type="button" class="category-button" value="' + category.categoryname + '">');
                button.data("category-id", category.categoryid); // 使用 data() 方法来存储 categoryid
                filterClass.append(button);
            });

            // 添加点击事件监听器
            $(".category-button").click(function () {
                var categoryId = $(this).data("category-id"); // 获取存储的 categoryid
                console.log("Clicked category id:", categoryId);
                // 处理点击事件
                searchCourseByCategory(categoryId);
            });
        }

        // 根据课程分类查询课程
        function searchCourseByCategory(categoryId) {
            $.ajax({
                url: 'LhMooc/courseServlet',
                type: 'get',
                data: {
                    action: "pageAndByCategory",
                    sortType: sortType,
                    pageNo: pageNo,
                    pageSize: pageSize,
                    categoryId: categoryId // 发送所选的分类 ID
                },
                dataType: "JSON",
                success: function (res) {
                    if (res.code === 200) {
                        var data = res.data;
                        displayCourseList(data.items); // 展示课程列表
                    } else {
                        alert(res.msg);
                    }
                },
                error: function (err) {
                    console.log('error', err);
                },
            });
        }

        // 展示课程列表
        function displayCourseList(data) {
            var courseListContainer = $("#course-list");
            courseListContainer.empty(); // 清空课程列表
            // 遍历课程数据并填充到页面中
            $.each(data, function (index, course) {
                var courseItem = $('<div class="course">');
                courseItem.append('<img class="course-photo" src="../../images/' + course.imgurl + '">');
                var courseDetails = $('<ul class="course-details">');
                courseDetails.append('<li><h4>' + course.coursename + '</h4></li>');
                courseDetails.append('<li>' + course.profile + '</li>');
                courseDetails.append('<li class="videostatus">' +
                    '<span><i class="icon icon-user"></i>收藏数' + course.followCount + '</span>' +
                    '<span><i class="icon icon-fuwu"></i>点赞数' + course.likeCount + '</span>' +
                    '<span><i class="icon icon-notice"></i>评论数' + course.commentCount + '</span>' +
                    '<i class="icon icon-shijian"></i>' +
                    '<input type="text" value="' + formatDate(course.createtime) + '" readonly>' +

                    '</li>');
                courseItem.append(courseDetails);
                courseListContainer.append(courseItem);
            });
        }

        // 将日期字符串转换为指定格式（YYYY/MM/DD HH:MM:SS）
        function formatDate(dateString) {
            var date = new Date(dateString);
            var year = date.getFullYear();
            var month = ('0' + (date.getMonth() + 1)).slice(-2); // 月份从0开始，需要加1，并确保两位数
            var day = ('0' + date.getDate()).slice(-2); // 确保两位数的日期
            var hours = ('0' + date.getHours()).slice(-2); // 确保两位数的小时
            var minutes = ('0' + date.getMinutes()).slice(-2); // 确保两位数的分钟
            var seconds = ('0' + date.getSeconds()).slice(-2); // 确保两位数的秒钟
            return year + '/' + month + '/' + day + ' ' + hours + ':' + minutes + ':' + seconds;
        }

        // 根据排序类型查询课程
        function searchBySortType(type) {
            sortType = type; // 更新排序类型
            searchCourseByCategory(); // 调用查询函数
        }
    </script>
</body>

<style>
    * {
        margin: 0px;
        padding: 0px;

    }

    body {
        background-color: #ecf0f4;
    }

    /* 遮障层 */
    .overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5);
        z-index: 999;
    }

    /*筛选栏*/
    #filter {
        width: 1200px;
        overflow: hidden;
        margin: 0 auto;
    }

    /*类别筛选栏*/
    #filter-class {
        height: 38px;
        background-color: white;
        border-radius: 10px 10px 0 0;
    }

    #filter-class>span {
        font-size: 15px;
        margin-top: 8px;
        margin-left: 20px;
        display: inline-block;
    }

    #filter-class>input {
        font-size: 13px;
        margin-left: 30px;
        height: 25px;
        padding-top: 3px;
        padding-bottom: 5px;
        padding-left: 8px;
        padding-right: 8px;
        /*width: 40px;*/
        /*border: 0.5px solid lightgrey;*/
        border: 0px;
        cursor: pointer;
        border-radius: 12px;
        color: grey;
        background-color: white;
    }

    #filter-class input:nth-child(2) {
        background-color: rgba(240, 20, 20, 0.8);
        color: white;
    }

    #filter-class>input:hover {
        color: white;
        background-color: rgba(240, 20, 20, 0.4);
    }

    /*排序筛选栏*/
    #filter-sort {
        margin-top: 1.5px;
        height: 38px;
        background-color: white;
    }

    #filter-sort>span {
        font-size: 15px;
        margin-top: 8px;
        margin-left: 20px;
        display: inline-block;
    }

    #filter-sort>input {
        font-size: 13px;
        margin-left: 30px;
        padding-top: 3px;
        padding-bottom: 5px;
        padding-left: 8px;
        padding-right: 8px;
        height: 25px;
        cursor: pointer;

        border: 0px;
        border-radius: 12px;
        color: grey;
        background-color: white;
    }

    #filter-sort input:nth-child(2) {
        background-color: rgba(240, 20, 20, 0.8);
        color: white;
    }

    #filter-sort>input:hover {
        color: white;
        background-color: rgba(240, 20, 20, 0.4);
    }

    /*课程列表栏*/
    #course-list {
        width: 1200px;
        overflow: hidden;
        margin: 0 auto;
        margin-top: 1px;
        background-color: white;
        border-radius: 0 0 10px 10px;

    }

    /*课程*/
    .course {
        margin-top: 40px;
        margin-left: 50px;
        height: 200px;
        width: 1100px;
        border: 1px solid lightgray;
        border-radius: 10px;
    }

    .course:hover {
        /*设置阴影效果*/
        box-shadow: 0px 5px 8px 1px rgb(128, 128, 128);

        margin-left: 45px;
    }

    .course-photo {
        margin-left: 15px;
        margin-top: 15px;
        float: left;
        width: 302px;
        height: 169px;
        border-radius: 7px;
    }

    /*课程详情*/
    .course-details {
        float: left;
        /*margin-top: 10px;*/
        margin-left: 40px;
        list-style-type: none;
    }

    .course-details>li {
        width: 650px;
    }

    .course-details>li:nth-child(1) {
        /*设置悬停指针样式*/
        cursor: pointer;
        margin-top: 15px;
        width: 650px;
    }

    .course-details>li:nth-child(1):hover {
        color: red;
    }

    .course-details>li:nth-child(2) {
        margin-top: 15px;
        width: 650px;
        height: 95px;
    }

    .course-details>li:nth-child(3) {
        margin-top: 15px;
        width: 650px;
    }

    /*课程发布时间*/
    .videostatus>input {
        border: 0px;
        font-size: 15px;
        color: black;
    }

    .videostatus>span {
        margin-right: 20px;
        font-size: 15px;
        color: black;
    }

    /*页码跳转栏*/
    .pageNumberColumn {
        margin-top: 20px;
        height: 20px;
        overflow: hidden;
        /*background-color: gray;*/
        margin-bottom: 30px;
    }

    .pageNumberColumn>span {
        width: 1200px;
        /*background-color: dodgerblue;*/
        display: inline-block;
        text-align: center;
    }

    .pageNumberColumn>span>span:nth-child(1),
    .pageNumberColumn>span>span:nth-child(2) {
        cursor: pointer;
        margin-right: 30px;
    }

    .pageNumberColumn>span>span:nth-child(3),
    .pageNumberColumn>span>span:nth-child(4),
    .pageNumberColumn>span>span:nth-child(5) {
        margin-right: 30px;
    }

    .pageNumberColumn>span>span:nth-child(6),
    .pageNumberColumn>span>span:nth-child(7) {
        cursor: pointer;
        margin-right: 30px;
    }

    .pageNumberColumn>span>span:nth-child(1):hover,
    .pageNumberColumn>span>span:nth-child(2):hover,
    .pageNumberColumn>span>span:nth-child(6):hover,
    .pageNumberColumn>span>span:nth-child(7):hover {
        color: red;
    }

    /* 激活状态样式 */
    .active {
        background-color: rgba(240, 20, 20, 0.8);
        color: white;
    }

    .active:hover {
        background-color: rgba(240, 20, 20, 0.4);
    }
</style>

</html>